# 정리  
키 쌍(Key Pair)는 EC2 인스턴스에 접속하기 위해 사용하는 암호화된 파일이다.   
AWS에서는 보안 문제때문에 EC2 인스턴스에 접속할 때 ID, 비밀번호 방식을 권장하지  
않는다.  

1. 암호화 방식
   1. 대칭키
      1. 암호화(Encryption)키와 복호화(Decryption)키가 동일
      2. 대칭키를 상대방에게 전달하는 구간에서 키가 노출되는 단점이 있다.  
      공개키에서는 이러한 단점을 개선하여 암호화하는 키와 복호화하는 키를 다르게  
      설계했다.   
   2. 공개키
      1. 대칭키의 단점을 보완
      2. 암호화하는 키와 복호화하는 키를 다르게 설계  
      3. 암호화하는 키는 공개키라고 하여 외부에 노출되어도 안전하다.
      4. 공개키에서 복호화에 필요한 비밀키 혹은 개인키를 추출하는 것은 매우 어렵다.  

AWS 키 쌍은 RSA 공개 키 알고리즘(Public Key Algorithm)을 사용하고 있다.  
AWS의 키 쌍은 공개 키(Public Key)와 비밀키 or 개인키(Private Key)가 쌍을 이루고 있기  
때문에 키 쌍이라고 부른다. 키 쌍은 리전별로 관리된다.  

- EC2는 퍼블릭 키를 인스턴스에 저장하고 프라이빗 키는 사용자가 저장한다.  
프라이빗 키를 사용하여 인스턴스에 안전하게 SSH로 연결한다.  
프라이빗 키를 소유하는 사람은 누구나 인스턴스에 연결할 수 있으므로 보안된 위치에   
프라이빗 키를 저장해 두는 것이 중요하다.  
SSH를 사용하여 인스턴스에 연결하려는 경우 키 페어를 지정해야 한다. 기존 키 페어를  
선택하거나 새로 만들 수 있다. 인스턴스가 처음 부팅될 때 시작 시 지정한 퍼블릭 키가  
Linux 인스턴스에 있는 `~/.ssh/authorized_keys` 내 항목에 배치된다. **SSH를 사용하여   
Linux 인스턴스에 연결할 때 로그인하려면 퍼블릭 키에 해당하는 프라이빗 키를 지정해야  
한다.** EC2에는 프라이빗 키의 사본이 보관되지 않으므로 프라이빗 키를 분실하면 이를   
복구할 방법이 전혀 없다.  

- **퍼블릭 키와 프라이빗 키는 하나의 쌍이다.**    
프라이빗 키로 암호화한 정보는 그 쌍이 되는 퍼블릭 키로만 복호화가 가능하고,   
퍼블릭 키로 암호화한 정보는 그 쌍이 되는 프라이빗 키로만 복호화가 가능하다.  

- 쌍이 되는 public 키는 아무 걱정 없이 자유롭게 누구에게든 공유할 수 있다.    
Public 키로 메시지를 암호화할 수 있는데, 그 암호화된 메시지는 그 쌍이 되는 private  
키로만 해석할 수 있다.  

- SSH Key 인증의 전체적인 흐름     
1. 클라이언트가 서버에 SSH 연결을 요청한다.   
2. 서버는 랜덤 챌린지(랜덤 데이터 스트링)를 생성해 클라이언트에게 보낸다.  
3. 클라이언트는 서버로부터 받은 챌린지(C)를 자신이 가지고 있는 private 키로 암호화   
된 메시지를 서버로 보낸다.  
4. 서버는 클라이언트에서 받은 암호화된 메시지를 public 키로 해석한 후 그 결과를  
2단계에서 자신이 클라이언트에게 보낸 랜덤 챌린지와 일치하는지 확인한다.(public  
키로 해석할 수 있는 메시지는 그 쌍이 되는 private 키를 가진 사람만이 만들 수 있기  
때문) 일치하면 클라이언트가 인증된 것이다.   

---

## EC2 인스턴스 접속을 위한 키 쌍
키 쌍(Key Pair)은 EC2인스턴스에 접속하기 위해 사용하는 암호화된 파일이다.  
AWS에서는 보안 문제때문에 EC2 인스턴스에 접속할 때 ID, 비밀번호 방식을 권장하지 않는다.  
(EC2 Linux 인스턴스의 경우 ID, 비밀번호 방식은 기본적으로 사용하지 않도록 설정되어 있다.)  
키 쌍 접속 방식은 ID와 비밀번호를 입력하지 않고도 접속할 수 있으며  
키 쌍 파일만 분실하지 않으면 매우 안전한다.  
이 키 쌍은 RSA 공개 키 알고리즘(Public Key Algorithm)을 사용하고 있다.  
  
암호화 방식에는 두 가지가 있는데 대칭 키와 공개 키 방식이 대표적이다.  
대칭 키 방식은 암호화(Encryption)하는 키와 복호화(Decryption)하는 키가  
동일하며 이 대칭 키를 상대방에게 전달하는 구간에서 키가 노출되는 단점이 있다.  
공개 키 방식은 이러한 단점을 개선하여 암호화하는 키와 복호화하는 키를 다르게 설계했고  
암호화 하는 키는 공개 키라고 하여 외부에 노출되어도 안전하다.  
공개 키에서 복호화에 필요한 비밀 키 혹은 개인키(Private Key)를 추출하는 것은 매우 어렵다.  
![image](https://user-images.githubusercontent.com/33191974/137584566-7bfa1210-a719-4613-8af4-358d6b3b81e0.png)  
AWS의 키 쌍은 공개 키와Public Key - 비밀키 혹은 개인키(Private Key)가 쌍을 이루고 있기 때문에  
키 쌍이라고 부른다. 그리고 키 쌍은 리전별로 관리된다. 키 쌍을 사용하면 보안성도 높일 수 있고  
ID와 비밀번호를 일일이 입력하지 않아도 되기 때문에 자동화에도 유리하다. (일반적으로 SSH 명령의 옵션에  
ID와 비밀번호를 지정하여 접속하도록 자동화할 수 있지만 비밀번호가 노출되는 치명적인 단점이 있다.) 
  
앞에서 EC2 인스턴스(Example Server)를 생성할 때 키 쌍도 함께 생성했다.  
이번에는 키 쌍을 새로 생성하거나, 이미 가지고 있는 키 쌍 파일을 활용하는 방법에 대해 알아본다.  

> #### 무차별 대입 공격(Brute force attack)
> Linux와 같이 SSH를 이용하여 터미널로 접속하는 OS는 로그인할 때마다  
> ID와 비밀번호를 입력하게 된다. 이런 경우 ID와 비밀번호를 반복적으로 대입하는 공격에  
> 노출될 수 있다. 무차별 대입 공격은 매우 빠른 속도로 자동화된 공격을 하기 때문에  
> 간단한 비밀번호는 금방 뚫릴 수 있다.  

### 아마도 아래와 같은 과정으로 인증이 진행되는 듯하다.
1. 로컬 호스트에 키 생성(private key, public key)
2. 원격 호스트에 public key 복사(public key 만으로는 복호화할 수 없기 때문에 여러 서버에 복사해도 무관)
3. 로컬 호스트에서 원격 호스트로 ssh 접속
4. 원격 호스트에서 public key로 암호화 된 정보를 로컬 호스트에게 주고, 로컬 호스트는 private key와 원격 호스트의 public key를 이용하여 복호화 수행
5. 인증 완료 시 암호 입력 필요 없이 접속 가능


> #### 공개키 암호화 방식
> 1. 개요  
> 암호화와 복호화에 같은 키를 사용하는 비밀키 암호화 기법과 달리, 암호화와  
> 복호화에 사용하는 키가 서로 다른 암호화 방식을 의미한다.  
> 지금의 디지털 서명이나 인터넷에서의 암호화 통신을 가능하게 만든 1등 공신으로  
> 이 공개키 알고리즘이 개발되지 않았다면 우리는 지금처럼 인터넷으로 결제하는 등의  
> 전자상거래 행위를 일체하기 힘들었을 것이다.  
> 비대칭키 암호화라고도 한다.  
>  
>2. 역사    
>공개키라는 개념이 구상된 것은 생각보다 오래되었다.  
>오래 전 대칭키 알고리즘만 존재했을 때에는 수신자와 송신자 사이에  
>동일한 암호화 키를 사용해야 했다. 또한, 송신자는 암호화된 메시지를 보내기 전에  
>무조건 수신자에게 어떤 방식으로든 그 암호화 키를 전달해야 하기 때문에 이는 보안상  
>큰 허점이 될 수 밖에 없었다. 중간에 통신을 감청하는 사람이 있다면 결국 암호화 키를  
>어떤 식으로든 전달할 때 이를 알아낼 수 있게 되었다. 따라서 학계에서는 70년대 이전부터  
>암호화와 복호화에 사용하는 키가 서로 다른 공개키의 개념을 구상해왔고, 이를 실제로 개발하기  
>위해 노력하였으나 실용적으로 사용할 수 있는 알고리즘은 쉽게 개발되지 않았다.  
>그러던 중 1976년에 디피와 헬만이 디피-헬만 키 교환 알고리즘을 학계에 발표하는데  
>이는 학계에 최초로 발표된(일종의) 공개키 암호화 방식이다.  
>항목을 보면 알겠지만 사실 엄밀히 말하면 이는 단순히 키 교환 알고리즘일뿐이므로  
>암호화/복호화에 대한 내용은 없다. 그러나 어떤 식으로든 송신자와 수신자가 어떤 내용을  
>서로 전달하면 그 내용을 제 3자가 감청해도 알 수 없는(알기 힘든), 특정한 정수를 가질 수 있다는  
>것이므로 이 정수를 키로 사용하여 기존의 대칭키 알고리즘을 사용하면 되기 때문에  
>결과적으로 학계에서 염원하던 공개키 알고리즘이 실제로 개발된 것과 같았다. 
>그러나 키 교환 알고리즘은 단순히 데이터를 안전하게 암호화하는 데에는 사용할 수 있으나  
>디지털 서명과 같은 곳에는 사용할 수 없기 때문에 그 자체로는 모든 문제를 해결하기에는  
>한계가 있었고 결국 실질적인 진짜 공개키 암호화 알고리즘의 개발이 필요했다.  
>그리고 1978년 세 수학자 Rivest, Shamir, Adleman이 엄밀한 의미에서 실제 공개키 "암호화"  
>알고리즘인 RSA를 개발하였고, 이 것이 처음으로 발표된 진정한 의미에서의 실용적인 공개키  
>암호화 알고리즘이며, 현재 가장 널리 알려진 공개키 암호화 알고리즘이다.  
>이후 디피-헬만 키 교환 알고리즘의 핵심인 이산로그 문제에 기반한 공개키 암호화인  
>ElGamal이나, 현재 많이 쓰이고 있는 타원 곡선 암호등등이 개발되면서  
>알고리즘의 성능과 보안성에서 더욱 개량되고 있다.  
>  
> 3. 용도  
> 3.1 기밀내용의 전달   
> A가 자신만 알고 있는 기밀을 B에게 전달하고자 할 때 사용한다.  
> B를 제외한 타인은 이 내용을 알 수 없어야 한다.  
>    1. B가 자신의 공개키를 공개한다.
>    2. A는 이 공개키로 문서를 암호화한다.
>    3. 암호화된 문서를 B에게 전달한다. 
>    4. B는 자신만이 가진 개인키로 이 문서를 해독한다.  
> 타인이 전달과정에서 암호화된 문서를 가로채더라도 B의 개인키가 없으면 해독이 불가능하다.  
> SSL/TLS에서 두 당사자가 사용할 "대칭키"를 전달하는 용도로 사용한다.  
> 다만 공개키 암호화는 처리 속도가 매우 느림으로 공개키 암호화는 TLS의 키 교환같이 간단한  
> 데이터를 전달하는 용도로만 사용된다.  
> 


























