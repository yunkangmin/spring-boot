# 정리  
- 도메인 구입을 하면 어떤 과정으로 IP를 알려주는지   
구입한 곳 네임서버(DNS 서버)를 사용해도 됨(Route 53 호스트 존 등록시 네임서버를  
도메인 구입한 곳에 설정해도됨. 그후 Route 53 호스트 존에 A 레코드를 추가하면  
네임서버에서 IP를 반환한다).  
네임 서버가 하는 일은 휴대폰에 전화번호를 내가 지정한 이름으로 저장해 가지고  
있는 연락처(전화번호부)가 하는 일과 비슷하다.  
nslookup을 사용했을 때 발생한 SERVFAIL을 해결하기 위해서, 그리고 현재의  
목적인 도메인으로 IP 주소를 대체하기 위해서는 DNS 레코드(A 레코드)를  
추가해야 한다. 
SERVFAIL은 네임서버가 해당 도메인에 대해 요청한 정보(IP)를 찾는데 실패했다는  
것이다. 이 것은 해당 도메인이 존재는 한다는 것을 내포하기도 한다. 아무도 구매
하지 않았고 전혀 사용되지 않는 도메인을 조회하려고 할 때에는 Non-eXistent  
Domain을 뜻하는 NXDOMAIN이라는 error가 발생한다.

- SOA(Start Of Authority) 레코드  
해당 도메인의 주 DNS 서버에 이름을 할당하고, 데이터를 얼마나 오래  
캐시에 저장할 수 있는지 저장하는 레코드이다.   
클라우드 DNS 서비스에 도메인을 등록하면 도메인에 대한 Zone 파일이 
형성되고, 존 파일마다 고유한 SOA 레코드가 부여된다. 이 것은 SOA   
레코드는 해당 도메인에 대해 네임서버가 인증(authoritative)된 자료임을  
의미하며, 도메인에 대한 정보가 최적의 상태로 유지, 관리되도록 한다.   

- 0.0.0.0/0: 모든 아웃바운드 IPv4 트래픽을 허용한다.  
- ::0: 모든 아웃바운드 IPv6 트래픽으 허용한다. 이 규칙은 VPC에 연결된  
IPv6 CIDR 블록이 있는 경우에만 추가된다. 

- IPv6: IPv4의 주소 고갈 문제를 해결하기 위하여 기존의 IPv4주소 체계를   
(32비트)128비트 크기로 확장한 차세대 인터넷 프로토콜 주소이다.  

---

Route 53을 사용하려면 도메인을 구입해야 한다. Route 53에서 직접 도메인을  
구입할 수도 있고, 외부에서 구입한 도메인을 사용할 수도 있다. 먼저 외부에서 
구입한 도메인을 설정하는 방법부터 설명한다. Route 53에서 도메인을 구입하는   
방법은 'Route 53에서 도메인 구입하기'를 참조하기 바란다.   
  
도메인 구입 사이트는 국내 포털 사이트에서 검색하면 많이 나온다. 도메인 구입   
방법과 사이트에 대해서는 따로 설명하지 않는다. 도메인을 구입했으면 AWS 콘솔로  
접속한 뒤 메인 화면에서 Compute & Networking의 Route 53을 클릭한다.  
  
Route 53에서 Hosted Zone을 생성하지 않았다면 아래 그림과 같은 페이지가 표시된다.   
Get Started Now를 클릭한다.  
<img src="https://user-images.githubusercontent.com/33191974/159167110-8ef31a38-3ed2-407c-a3f1-108549f82b22.png" width="50%" height="50%"/>    
위쪽 Create Hosted Zone 버튼을 클릭한다.  
<img src="https://user-images.githubusercontent.com/33191974/159167149-8615003d-a3b8-426d-9f90-78930a98a0c5.png" width="50%" height="50%"/>     
오른쪽 부분에서 Domain Name 부분에 도메인을 입력한다. 여기서 www 서브 도메인을  
제외한 루트 도메인을 입력한다. 필자는 slkjfd.cf 도메인을 사용했으며, 각자가  
구입한 도메인을 입력하면 된다. Comment는 도메인의 설명을 입력하는 부분이며  
입력하지 않아도 상관없다. 아래쪽 Create 버튼을 클릭한다.   
<img src="https://user-images.githubusercontent.com/33191974/159167272-4c705f3b-b24d-4a60-b811-96ca79934333.png" width="50%" height="50%"/>   
  
Hosted Zone이 생성되었다. 이제부터 가장 중요한 부분이다. 오른쪽을 보면  
Delegation Set에 4개의 도메인이 보인다. 이 도메인들이 네임서버이다. 
  
<img src="https://user-images.githubusercontent.com/33191974/159203166-0e906fd1-6569-4268-b6d5-e531a8cdaf35.png" width="50%" height="50%"/>   
    
도메인을 구입한 사이트에 접속한 뒤 네임서버를 설정해줘야 한다. 아래 그림은  
필자가 도메인을 구입한 사이트에서 제공하는 네임서버 설정 페이지이다.  
  
Delegation Set에 나온 도메인 4개를 차례대로 1차, 2차, 3차, 4차에 입력한 뒤   
설정을 변경한다.  
   
<img src="https://user-images.githubusercontent.com/33191974/159203255-9c395d2e-1d3c-4e8f-a92a-c0df4c521856.png" width="50%" height="50%"/>   
     
이제 도메인을 구입한 사이트에 접속하여 구입한 도메인을 조회한다.   
도메인의 네임서버가 완전히 변경되었는지 확인할 수 있다. 아래 그림처럼 NS 1,  
2, 3, 4에 방금 설정한 네임서버가 표시되면 변경이 완료된 것이다.

> #### 네임서버 변경 적용 시간  
> 도메인을 구입한 사이트에서 네임서버를 변경했더라도 곧바로 적용되지 않는다.  
> 루트서버와 네임서버의 캐시 상황에 따라 최소 5 ~ 10분에서 몇 일씩 걸리기도  
> 한다(요즘은 대부분 빨리 처리된다).  
  






























