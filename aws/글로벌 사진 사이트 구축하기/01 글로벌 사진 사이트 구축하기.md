AWS 리소스를 활용하여 부하에 따라 자동 확장이 되고, 전 세계 어디서나 빠른  
속도로 사진을 제공하는 글로벌 사진 사이트를 구축하는 예제이다. S3 버킷에  
이미지를 저장하는 방법, RDS DB 인스턴스에 데이터를 저장하는 방법, SQS 큐와   
EC2 인스턴스로 이미지를 처리하는 방법, IAM 역할을 사용하는 방법, ELB 로드   
밸런서와 Auto Scaling을 사용하는 방법에 대해 알아보자.    
  
지금까지 각 AWS 리소스들의 사용 방법을 알아봤다. 이번 장부터는 실전과 유사한   
사례를 설명하고, AWS 리소스들을 조합하여 직접 구축해보자. 글로벌 사진 사이트는  
인스타그램, 트윗픽과 같은 서비스를 떠올리면 이해하기 쉽다. 그리고 의류 쇼핑몰도   
이미지를 많이 사용하므로 성격이 비슷하다. 좀 더 응용하면 사진 사이트 구성에   
장바구니와 결제 기능을 붙이면 쇼핑몰이 된다.   
  
글로벌 사진 사이트를 구축하려면 어떻게 해야 할까? 사용할 AWS 리소스를 선택하기  
전에 구축하려는 서비스의 요구사항을 먼저 파악해야 한다.  
  
글로벌 사진 사이트의 요구사항을 정리해보면 다음과 같다.   
- 대용량의 이미지 파일을 저장해야 한다.  
- 전 세계 어디서나 사이트 및 이미지를 보여주는 속도가 빨라야 한다.  
- 원본 사진의 크기를 웹사이트에 맞게 조절해야 한다(요즘 사진들은 해상도가  
매우 높으므로).   
- 사용자가 늘어났을 때 대비할 수 있어야 한다.   

이제 요구사항에 맞게 사용할 AWS 리소스와 서비스 구조를 설계해보자.   
- 대용량의 이미지를 저장해야 하니 S3가 적합하다. 아래 표처럼 EBS에 저장하는   
것은 비효율적이고 비용이 많이 든다.  
- 전 세계에 빠르게 사이트와 이미지를 배포해야 하니 CloudFront가 적합하다.   
- 원본 사진의 크기를 조절할 때는 EC2를 사용해야 한다. 하지만, 이미지 변환을   
웹 서버에서 처리한다면 웹 사이트 반응 속도에 영향을 미친다. 따라서 변환할   
이미지 목록을 SQS에 메세지로 보낸 뒤 변환 전용 EC2 인스턴스에서 처리하면 된다.   
- EC2에 웹 서버를 구축하고, 데이터는 RDS에 저장한다. 사용자가 증가했을 때는   
ELB와 Auto Scaling으로 대응하면 되고, RDS의 DB 인스턴스 클래스를 높이고   
용량을 늘리면 된다.  
- 도메인 처리는 Route 53을 사용한다.  
- 사이트의 소스(HTML, JavaScript) 파일은 S3에 저장한다(GitHub, Bitbucket이나   
자체 구축한 버전 관리 시스템 서버를 사용해도 된다).  

표) Tokyo 리전에서 EBS, S3, 100GB당 한 달 요금   
(EBS General Purpose SSD | EBS Magnetic | S3 Standard | S3 Reduced Redundancy)  
- 100GB | $12    | $8    | $3.3 | $2.64
- 1TB   | $120   | $80   | $33  | $26.4
- 10TB  | $1,200 | $ 800 | $324 | $ 259

EBS는 EC2를 통해 데이터를 전송하고, S3는 직접 전송한다고 했을 때 데이터 전송   
요금은 동일하다.  
  
글로벌 사진 웹사이트 구성도   
<img src="https://user-images.githubusercontent.com/33191974/159156073-b7cd2602-f78b-4041-a573-a1cb6913bc3b.png" width="50%" height="50%"/>  
필자는 프로젝트 이름은 ExamplePhoto로 하고, 코드양을 줄이기 위해 Node.js에  
JavaScript로 구현할 것이다. 실무에서는 각자 상황에 맞게 원하는 언어와     
플랫폼을 사용하면 된다.   
  
이제 ExamplePhoto 서비스의 동작 흐름이다.  
1. examplephoto.com에 이미지 파일(사진)을 올린다.  
2. 웹 서버 EC2 인스턴스는 이미지 파일을 S3 버킷에 저장하고, 이미지 파일명을  
SQS 메시지로 보낸다. 그리고 이미지 파일 정보를 RDS 데이터베이스에 저장한다.  
3. 이미지 변환 EC2 인스턴스에서는 SQS에서 메시지를 받은 뒤 이미지 파일의   
해상도를 줄인다. 그리고 해상도를 줄인 이미지 파일을 S3 버킷에 저장하고,  
SQS 메시지를 삭제한다.   
4. 웹 서버에서는 RDS 데이터베이스에서 이미지 파일 목록을 가져와서 보여준다.  
  
예제 소스 코드는 필자의 GitHub 저장소에서 받을 수 있다.  
https://github.com/pyrasis/awsbook






















