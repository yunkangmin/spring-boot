=앞에서 등장한 'RAS'에 대하여 검토할 때 어떤 지표를 사용하는가, 또한 그 지표의 수치를 높이기  
위해서는 구체적으로 어떤 방법이 사용되는가에 대해 구체적으로 설명한다.  
  
앞에 등장한 RAS를 검토할 때는 아래와 같은 지표를 사용한다.  
- 가동률
- 장애 발생 간격(Mean Time Between Failures = MTBF)
- 평균 복구 시간(Mean Time To Repair = MTTR)

일반적으로 시스템에 발생한 문제를 '장애'라고 한다.  
보통 계획 단계에서의 가동률은 MTBF / (MTBF + MTTR)로 계산하며, MTBF와 MTTR의 계산식은  
아래와 같다.  
- 가동률 = MTBF / (MTBF + MTTR)
- MTBF = 누적 사용 시간 / 고장 횟수
- MTTR = 누적 수리 시간 / 고장 횟수

실제로 비 엔지니어가 상상할 수 있는 것은 가동률이기 때문에 가동률을 축으로 각종 요소를 결정한다.  
이 단계에서는 사용자가 시스템을 이용할 수 없는 시간이 어느 정도인지를 지표로 하여 시스템 전체의  
가동률을 결정한다.  
  
예를 들어 브라우저를 통해 이용하는 웹 서비스의 경우, 사용자가 액세스를 해도 화면이 표시되지 않거나  
기능을 이용할 수 없는 시간이 어느 정도인지로 판단한다.  
  
구체적으로 24시간 가동하는 시스템에서 가동률 99.99%를 목표로 한다면 아래와 같은 결과가 나온다.  
- 연간 정지 시간이 3153.6초 이내
- 만약 MTTR이 4분이라면 MTBF는 28일
- MTTR이 18분이라면 MTBF는 125일

이에 대한 계산식은 다음과 같다.  
- #### 연간으로 환산한 초 수와 가동률부터 정지 시간을 산출
  86,400초(24시간) x 365일 x 0.01%(가동률 99.99%) = 3153.6초
- #### MTTR이 4분인 경우
  99.99% = 60 x 24 x MTBF(분으로 단위를 맞춤) / (60 x 24 x MTBF + 4)
- #### MTTR이 18분인 경우
  99.99% = 60 x 24 x MTBF / (60 x 24 x MTBF + 18)
  
예외적으로 가동률을 계산할 때 계획적인 유지보수를 위한 시스템 정지 시간은 반영하지 않을 수도 있다.  
또한 가동률을 시스템 가용성의 지표롤 사용할 경우에는 계획적인 유지보수를 고려하지 않는다.  
  
단, 24시간 365일 가동을 전제로 하는 시스템에서는 계획적인 유지보수를 하지 않아도 운용이 가능하도록  
하는 것을 목표로 하지만, 비용과 작업 과정 및 납기 등의 [트레이드 오프](https://itmemo.tistory.com/267)를 감안하여 계획적인 유지보수를  
고려하는 경우도 있다.  
또, 지진과 같이 발생 간격이 길고 영향이 큰 재해에 대해서는 평상시와는 다른 별도의 상황으로 취급하는  
경우가 많다. 

### 가동률을 높이는 방법
가동률을 높이기 위해서는 어떻게 하면 될까?  
가동률을 높이기 위해서는  
1. 요소 각각의 가동률을 높이고
2. 요소를 조합해 전체의 가동률을 높이며
3. 적절한 [프로비저닝](https://ko.wikipedia.org/wiki/%ED%94%84%EB%A1%9C%EB%B9%84%EC%A0%80%EB%8B%9D)으로 부하문제를 피하는 것이 중요하다. 

위의 3가지 방법에 대한 구체적인 내용은 뒤에서 다시 설명하기로 하고, 우선 가동률을 높이기 위한  
기본적인 개념에 대해 알아보자.  
가동률을 높이기 위해서는 MTBF를 길게 하거나, MTTR을 짧게 하는 것이 중요하다.  
그 방법으로는 다중화를 사용하는데, 이것에 의해 MTTR이 짧아지기도 하고 '0'이 되기도 한다.  
단일 장애 포인트<sup>SPOF, Single Point Of Failure</sup>를 없애거나 SPOF가 남아있는 경우에는  
MTBF를 길게 MTTR을 짧게 하는 방향으로 조정한다.  
```
다중화란 시스템의 어느 구성 요소에서 장애가 발생한 경우에 다른 구성 요소가 그 처리를 넘겨받아
시스템 전체의 가용성을 높이도록 하는 것을 말한다. 
단일 장애 포인트는 시스템의 구성 요소 중 다중화되어 있지 않은 단일 구성 요소를 말한다.  
예를 들어 신체에서는 눈, 손, 귀, 폐 등은 2개씩 다중화되어 있지만, 입은 다중화되어 있지 않기 때문에
단일 장애 포인트라고 말할 수 있다. 
```
작업의 흐름에 따라 다중화를 검토할 때는 빠짐없이 검토하는 것이 매우 중요하며,  
누락을 방지하는 방법으로 전문가의 리뷰등이 필요하다.  
만일 스스로 검토할 경우에는 데이터의 흐름에 따라 생각하다 보면 누락을 방지하기 수월해진다.  
  
예를 들어 스마트폰용 웹 시스템의 경우에는 데이터의 흐름을 바탕으로 하여 사용자의 브라우저에서  
단말기, 전파, 이동통신사의 네트워크, 데이터 센터의 인터넷 회선 사업자, 라우터, 방화벽, ...,  
서버의 디스크, 프로그램과 같이 물리적인 데이터가 전달되는 순서로 고려하면 누락을 방지하기 쉬워진다.  
  
가동률을 높이기 위해서는 특별한 경우에는 어느 정도로 대처할 것인지를 결정하는 것이 매우 중요하다.  
예상되는 장애의 크기에 따라 검토할 범위가 달라지기 때문에 필요 이상으로 걱정하는 것은 아닌지 또는  
예상하는 장애의 크기가 너무 작은 것은 아닌지 잘 확인해야 한다.  
다중화와 부하 분산은 이렇게 여분의 요소를 준비하여 이상 상태에 대응하는 방법이다.  
  
고장 발생 시 수리 작업의 흐름을 적절하게 정비하는 것에 대해서는 뒤에서 상세히 설명한다.  
또, 대규모 재해 발생에 대해서는 이와는 별도로 다룬다.  
  
서비스 제공을 위해 필요한 장비의 최소 대수를 N이라고 하면, 평상시의 최소 대수는 N + 1이 된다.  
이것을 흔히 N + 1 구성이라고 한다.  
예를 들어, 웹 서버가 2대는 있어야 일상적인 부하를 견딜 수 있는 경우라면 평상시에 3대 정도는  
준비해 둘 필요가 있다.  
  
실제로는 N + 1 구성에서 이상 발생 시 곧바로 추가 여분이 필요한 상황이 되기 때문에, MTTR이 길어질 것이  
분명할 때는 N + 2 구성을 취해야 할 필요가 있는 경우도 있다.  
하지만 비용대비 효과를 고려하여 리스크를 감수하고라도 비용을 절약할 목적으로 N + 1 구성을 고집하는 경우도 많다.  
  
덧붙여, N + 1이 N이 된 다음 다시 N + 1이 될 때까지가 '장애대응'이라는 것을 꼭 기억해두자.  

#### 요소 각각의 가동률을 높게 한다.
- ##### 서버용 부품을 사용하기
  계속해서 요소 각각의 가동률을 높게 하는 방버에 대하여 설명한다. 
  우선은 서버용 부품을 사용해 MTBF를 길게 하는 것이 중요하다.  
  CPU, 메모리, 하드디스크, SSD등에는 서버용 제품이 따로 있다.  
  또한, 전용장소(데이터 센터)에 서버를 설치하는 것도 효과적이다.  
  이렇게 하면 진동이나 먼지 등에 의한 성능 감소를 줄일 수 있기 때문에  
  MTBF가 길어진다.  
- ##### 부품을 이중화하기
  부품을 이중화하면 동시에 고장이 나지 않는 한 서비스가 중지되지 않으므로 이 방법을 활용해보자.  
  서버의 부품 단위 다중화에는 디스크의 RAID를 구성하는 디스크의 로드(제품 번호나 제조일자)를  
  여러 종류로 혼합하는 경우도 있다.  
  'RAID'에 대해서는 2장에서 자세하게 설명한다. 
  내부 부품이 완전하게 이중화되어 있는 서버도 있지만, 금융기관 정도에서만 사용하는 것이라 엄청나게  
  비싸다.  
  간혹 수리를 위해 정지하는 경우도 있기 때문에 주의해야 한다.  
  이중화를 하면 하나의 부품에 고장이 발생해도 시스템 작동에 지장은 없지만, 고장이 발생한 부품의 교환을  
  위해서는 필요에 따라 서버를 정지시켜야 하는 경우도 있다.  
  따라서 고장을 조기에 발견하여 서버가 완전히 정지하기 전에 적절히 대응하는 것이 중요하다.  
  요소 각각에 대한 대책에는 일정 수준 이상을 요구하는 순간 비용이 발생한다.  
  따라서 요소 각각의 가동률 향상을 위해서는 가격이 저렴한 상용 제품을 사용하고 여러 요소를 다중화 기술등으로  
  조합하는 것이 효과적이다.  
- ##### 요소 각각의 가동률을 확인하기
  가동률은 필요한 요소 중에서 가장 가동률이 낮은 요소의 가동률로 결정된다.  
  사용자가 시스템을 이용하기 위해 사용하는 모든 서버에 대해 빠짐없이 확인하자.  
  웹 서비스의 경우라면 서버뿐만 아니라 데이터 센터, 인터넷 회선, DNS 등에 대해서도 대략적으로 한 번 확인해두는  
  것이 좋다.  
  데이터 센터나 인터넷 회선 등은 SLA<sup>Service Level Agreement</sup>로서 명시되어 있는 수치를 근거로 한다.  
  데이터 센터는 세계적으로 사용되고 있는 규격이 있으며, 등급을 'Tier'로 표시한다.  
  'Tier 3'라고 하면 설비 전원의 다중화와 99.982%의 가용성 등이 요건이 된다.  
  이는 여러 계통의 사업자로부터 전원 공급을 받거나, 대형 자가발전 장치등으로 대응하는 경우가 많은 것 같다.  
  덧붙여 일본에서는 내진성 등에 대해서도 언급하는 데이터 센터가 많다.  
    
  데이터 센터는 일반적으로 전원을 이중화하는 등의 조치를 취하고 있다.  
  그 예로, 일본에서는 어느 정도 규모를 가진 빌딩의 경우 연 1회 법으로 정한 검사를 받기 위하여 정전이 필요하다.  
  하지만 데이터 센터는 전원을 이중화하고 있기 때문에 문제없이 계속 이용할 수 있다.  
  데이터 센터 측에서 전원 이중화를 하지 않는 경우에는 스스로 무정전 전원장치<sup>USP</sup>를 설치하는 등의  
  대응이 필요한데, UPS를 사용함에 따라 배터리 정기 교환과 같은 정비가 필요하기 때문에 운용이 더욱 어려워진다.  
    
  인터넷 회선은 가용성과 품질(패킷의 전송 지연)을 SLA로서 강조하는 경우가 많으니, 어떤 항목이라도 SLA를 초과하는  
  경우에 대한 사업자 측 대응을 미리 확인해 둘 필요가 있다.  
  가용성에 대한 SLA가 있는데도 그 범위 안에 들지 못한 경우, 대부분 이용 요금의 환불로 대응이 이루어진다.  
  SLA를 반드시 보장하도록 구성되어 있는 것이 아니라 '이 정도 요금이면 이 정도 성능입니다.'라는 제시를 하고 있을 뿐  
  이므로 사용자 측에서 SLA의 수치를 어떻게 인식할 것인지 판단하도록 하자.  

#### 요소를 조합해 서비스의 가동률을 높게 한다. 
계속해서 요소를 조합하여 전체 가동률을 높게 하는 방법에 대해 설명한다.  
앞서 언급한 대로 요소 각각에 대한 가동률을 높이는 것에는 한계가 있기 때문에 다중화 기술을 이용하여 가동률을 높이는  
것이 실력을 발휘할 수 있는 방법이다.  

다중화 구성에는 다중화된 요소를 모두 이용할 수 있는 'Active-Active'와 다중화된 요소 중 한쪽은 이용할 수 없는 'Active-
Standby'의 두 종류가 있다.  
'Active-Standby'는 Standby의 방식에 따라 다시 세 종류로 나뉜다.  
![image](https://user-images.githubusercontent.com/33191974/128625169-8f7a6640-9b3c-48b8-93f0-4a4987109fa1.png)  
위의 표에서 '나름대로'처럼 상당히 애매한 표현을 사용했지만,  뚜렷한 정의 없이 대체로 그러한 느낌이다.  
  
Wram Standby의 사례로는 예전의 PostgreSQL과 같이 '데이터 파일은 동기화하고 있지만, 이를 이용 가능하도록 하기 위해서는  
데이터 리스토어에 대한 처리가 필요한 구성'을 들 수 있다.  
  
기술적으로 가능하다면 Active-Active가 가장 가동률이 높아진다.  
데이터를 저장하지 않는 Stateless방식의 요소라면 Active-Active를 비교적 쉽게 구현할 수 있다.  
대표적인 예로, 웹 서버에서 로컬 스토리지나 임시 파일등을 이용하지 않는 경우에는 매우 간단하게 구현할 수 있다.  
  
기본적으로 Active-Active가 가능하도록 최대한 Stateless로 해야 한다.  
다만, 데이터베이스 서버나 파일 서버 등 데이터를 저장하는 부분을 Active-Active로 하면 대게는 데이터 [정합성](https://simple-easy-honest.tistory.com/6) 유지를 위해  
평소에도 동기화가 필요하기 때문에 동작이 느려지므로 주의하기 바란다.  
   
다중화에 대한 자세한 내용은 2장에서 설명한다.  

#### 적절한 프로비저닝으로 부하 문제를 피한다.
지금부터 적절한 프로비저닝으로 부하 문제를 피하는 방법에 대하여 설명한다.  
프로비저닝은 사용자 수 등을 예측하여 적절하게 리소스를 준비하는 것을 말한다.  
웹을 사용하지 않는 시스템의 대부분은 사용자 수 등을 미리 예측할 수 있지만, 웹을 사용하는 일반적인  
BtoC 서비스는 부하를 예측하기 어렵다.  
  
특히 최근에는 트위터 등의 소셜 미디어에 의해 순식간에 확산되고, 잠깐 동안만 주목을 끄는 경우가 많다.  
이들은 부하가 극단적으로 변하기 때문에 예측에 어려움이 있지만, 예산 안에서 최대한 대응하도록 하자.  
  
- ##### 스케일 업과 스케일 아웃
  부하에 대응하는 방법으로 스케일 업과 스케일 아웃이라는 것이 있다.  
  스케일 업은 서버등 각 요소의 성능을 향상시키는 방법이며, 스케일 아웃은 서버 등 각 요소의 수를 늘리는  
  방법이다.  
    
  어느 정도 규모까지는 스케일 업이 좋지만, 이는 일정 범위를 넘어서는 순간 비용대비 효과가 나빠진다.  
  따라서 웹 서버등은 스케일 아웃이 가능하도록 하는 것이 일반적이다.  
  최근에는 클라우드 기반을 이용함으로써 오토 스케일 등의 자동 스케일릴을 설정하느 것이 가능하다.  
  그러나 오토 스케일을 사용하더라도 부하의 증가 속도를 스케일링 속도가 따라잡지 못할 수도 있다.  
  스케일링의 시작부터 완료까지는 시간의 지연이 생긴다는 것을 잊지 않기 바란다.  
    
  특정 이슈가 'Yahoo!'와 같은 포털 사이트에서 다루어진 경우라면 1.5 ~ 2시간정도 액세스가 계속되기 때문에  
  스케일링의 효과가 있지만, TV에서 다루어진 경우에는 등장으로부터 30분 정도, 트위터에서 유명인이 언급한 경우  
  에는 15분 정도 만에 가라앉기 때문에 오토 스케일로 대응하는 것은 적절하지 않다.  
  따라서 부하의 증가를 미리 예상하고 있는 경우에는 사전에 대처해 두지 않으면 아무것도 하지 않은 것과 마찬가지가  
  된다.  
    
  부하의 관점에서도 최소한으로 준비해 두지 않으면 안 되는 것이 N + 1 구성, 조금 더 안심할 수 있는 것은 N + 2 구성이다.  
  이는 스케일링의 속도와 여유 용량으로 판단하도록 하자.  
    
  스케일 아웃이 가능한 구성에는 구체적으로 두 가지 요소가 있는데, 하나는 기능적으로 스케일 아웃이 가능한 구성이다.  
  이때는 서버와 최종 사용자가 직접 연결되어 있어서 처음부터 스케일 아웃을 할 수 없도록 구성해서는 안된다.  
  또 하나는 수를 늘리는 것이지만 사용자 수와 액세스 수에 대해 스케일 팩터가 되어 있는 구성이어야 한다.  
    
  예를 들어 웹 서버가 보틀넥이 아닌데도 웹 서버를 늘리는 것은 의미가 없다.  
  튜닝과 부하 분산의 구체적인 방법에 대해서는 7장과 8장에서 설명한다.  

### 고장 발생 시의 대응 방법
고장이 발생하면 대응 및 검토해야 하는 것들이 무수히 많기 때문에 고장 시에 어떤 대응을 할 것인지 미리 결정해 두면  
원활하게 대응할 수 있다.  
예를 들어 기기가 고장난 경우, 고장에 대응하고 다시 셋업한 후 재 투입이 필요하다면 고장 대응에 소요되는 시간은 어느  
정도인지, 물리적인 기기의 지원 계약에 따라 의뢰한 시간으로부터 4시간 이내 또는 다음 영업일이나 [3영업일](https://m.blog.naver.com/PostView.naver?isHttpsRedirect=true&blogId=gylee73&logNo=120011653066) 이내에 완료  
가능 등과 같이 대응하는데 소요되는 시간이 달라지게 된다.  
  
또한 계약 내용뿐 아니라, 의뢰가 처리될 때까지 조사가 필요한 계약 패턴도 있다.  
이 경우에는 운용 체계에서의 대응 소요 시간이 어느 정도 되는지도 계산에 넣을 필요가 있다.  
  
필자의 경험상 기기 제조사에 따라서 '전원이 들어오는 경우는 진단 툴로 고장 위치를 확실하게 알 수 없는 한 수리 대응은  
하지 않는다'와 같이 수리 대응을 회피하는 것처럼 유사시에 원활히 대응할 수 없는 경우도 많다.  
클라우드 기반이라면 수리에 연연하지 말고 제거하는 것이 좋다.  
다시 고장이 발생하면 또다시 만들면 된다. 
  
AWS와 같은 Infrastructure as Code 계열(API 등을 이용해 프로그램이나 코드에 따라 인프라를 자동적으로 조정하는 것)의  
클라우드 서비스라면 자동화가 되어 있을 경우 15분 정도에 복구가 완료되도록 만들 수 있겠지만 예상 외의 상황이 발생하여  
자동적으로 복구를 할 수 없는 사태가 발생한 경우에는 어떻게 처리할 것인지 잘 검토해 두도록 하자.  
해결 방법으로 필자가 근무하는 Heart Beats와 같이 24시간 365일 체제를 가진 모니터링 서비스 사업자에게 위탁하는 것도  
검토할만 하다.  

### 대규모 재해 시의 대응 방법
대규모 재해 시에 관련해서 검토할 때는 사업소의 배치, 시스템 이용자의 배치 및 재해 발생 직후에 시스템이 해야 할 역할과  
가치를 고려하여 판단한다.  
  
예를 들어 도심지 중심부의 지진을 가정한 경우, 서비스 사용자가 도심에만 있고 여가를 누리기 위한 유형의 서비스라면  
지진 직후에는 별로 이용할 가능성이 없기 때문에 가동률 계산 시 고려하지 않는다.  
  
또한 사업소가 도심에만 있고 서비스 제공에 직원의 출근이 필요한 서비스 역시 지진 직후에는 직원이 출근을 할 수 없는 상황이  
예상되므로 시스템이 가동되고 있어도 의미가 없기 때문에 가동률 계산 시 고려하지 않는다.  
  
예를 들어, 지진 등의 대규모 재해 발생 시에는 업무 재개로부터 3영업일 이내에 시스템을 재개한다는 내용 등으로 규정한다.  
  
재해 대책에 대해서는 아래와 같은 사항에 대해 검토한다.  

##### 대응 범위
- 데이터만이라도 지킬 것인가
- 시스템의 일부만이라도 계속 가동하게 할 것인가
- 시스템을 완전하게 계속 가동하도록 할 것인가

##### 전환방법
- 자동
- 수동

수동 전환의 경우, 전환할 수 있는 담당자가 작업을 수행할 수 있도록 준비될 때까지는 전환이 불가능하기 때문에 현실적인 선을  
모색할 필요가 있다.  
이런 경우 재해지 밖에 있는 사람이 대응할 수 있도록 준비되어 있지 않으면 결국 준비한 재해 대책을 이요할 수 없게 될 수도 있다.  
  
재해 복구 대책으로서 재해 발생 시에도 업무를 게속하기 위하여 멀리 떨어진 장소에 시스템을 구축하는 경우가 많은 것 같다.  
재해 복구 대책을 위한 업체 선정에도 뜻 밖의 함정이 있으니 주의하는 것이 좋다.  
  
단지 지리적으로 떨어진 곳에 설치하는 것뿐 아니라 데이터 센터 사업자, 전력회사, 네트워크 사업자를 제대로 선정하도록 하자.  
지리적으로 떨어져 있어도 네트워크 사업자가 동일한 경우는 결국 네트워크 문제가 해결되지 않을 가능성이 있기 때문이다.  

#### COLUMN RASIS, CIA 검토하기
1.3 인프라 설계 시의 주의 점에서 RAS와 함께 등장한 RASIS와 CIA에 대해서도 간단한 설명과 검토 시의 주의점을 정리해보자.  
반복되는 내용이지만 RASIS는 'Reliability(신뢰성)', 'Availability(가용성)', 'Serviceability(유지 보수성)', 'Integrity  
(무결성)', 'Security(안정성)'를 의미하고, CIA는 'Availability(가용성)', 'Integrity(무결성)', 'Confidentiality(기밀성)'  
를 의미한다.  
RASIS의 IS와 CIA의 CI는 숫자로 측정하기는 어렵지만 예상했던 내용과 검토 결과는 시스템의 기본으로 남겨두어야 한다.  
예를 들어 AWS의 하나로 제공되고 있는 'Amazon S3'를 사용하는 경우 데이터를 세 군데 이상의 각기 다른 장소에 보관하고  
있기 때문에 신뢰성이 높은 서비스이지만, 그렇다고 해도 가용성 99.99%, 내구성(Durability) 99.9999999999%로 100%가 되지는  
못한다.  
(여기에서 'Durability'는 데이터 손실이 발생할 확률이라는 의미로 사용되고 잇으니 'Integrity'와 거의 같은 의미이다.)  
  
또한, 'Security'에 대해서는 문맥에 따라 기술적인 것뿐만 아니라 회사 내부 통제의 맥락에서 내부 감사의 관점인 경우도 있기 때문에  
주의가 필요하다.  
'Security'에 대한 항목은 정보가 손실되지 않을 것, 변경되지 않을 것, 접근해도 되는 사람만 접근 가능할 것 등의 요건이며  
각각의 수준과 구체적인 내용 및 방법을 검토해 나가게 된다.  
  
설계가 완료되면 '검토 결과' '그렇게 결정한 배경'을 함께 문서로 남겨두자.  
이 부분은 애플리케이션 설계서와 비슷하다. 검토 결과뿐 아니라 그렇게 된 배경도 함께 문서로 남김으로써 시대의 변천에 따라  
기술이 변하더라도 유연하게 대응할 수 있게 된다.  
  
도구로는 Word, Excel, Visio 등의 Microsoft Office 제품을 이용한 것이 많지만, 최근에는 Sphinx, Graphviz, Blockdiag,  
Cacoo등을 이용하여 다음과 같은 방법도 많이 이용되고 있다.  
- 종이매체를 전제로 하지 않는다. 
- 버전 관리와 이력 관리가 가능한(git 등) 툴을 함께 사용한다. 






































